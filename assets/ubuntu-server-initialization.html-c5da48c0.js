import{_ as t,M as d,p as c,q as r,R as e,t as s,N as a,a1 as i}from"./framework-96b046e1.js";const l="/blog/assets/ubuntu-terminal-color-scheme-c5fd4ad6.png",u={},o=i(`<h1 id="ubuntu-服务器初始化" tabindex="-1"><a class="header-anchor" href="#ubuntu-服务器初始化" aria-hidden="true">#</a> Ubuntu 服务器初始化</h1><p>初次创建新 Ubuntu 服务器时，应该尽早完成一些初始化配置，作为基本设置的一部分。</p><p>这将增加服务器的安全性和可用性，并为后续操作奠定坚实的基础。</p><p>下面以初始化 Ubuntu 22.04 版本演示服务器的初始化流程。</p><h2 id="登录服务器" tabindex="-1"><a class="header-anchor" href="#登录服务器" aria-hidden="true">#</a> 登录服务器</h2><p>如果要登录到服务器，需要从服务商那边获取服务器的公网 IP 地址 和 root 帐户的密码。</p><p>可以通过下面的命令登录到服务器：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ssh</span> root@SERVER_IP_ADDRESS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后提供认证凭证，可以选择使用密码或私钥，完成登录过程。</p><h2 id="设置个性化主机名" tabindex="-1"><a class="header-anchor" href="#设置个性化主机名" aria-hidden="true">#</a> 设置个性化主机名</h2><p>默认主机的 hostname 都是随机生成，不方便识别，这里以 <code>ubuntu-study</code> 为实例作为主机名进行设置。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> hostnamectl set-hostname ubuntu-study <span class="token comment"># 设置主机名</span>
<span class="token function">sudo</span> hostnamectl <span class="token comment"># 查看主机名</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>设置完成之后，需要退出终端重新登录就可以看到自定义主机名。</p></blockquote><h2 id="终端配色" tabindex="-1"><a class="header-anchor" href="#终端配色" aria-hidden="true">#</a> 终端配色</h2><p>为了设置终端颜色，需要对 <code>~/.bashrc</code> 文件中的 PS1 变量进行定制，<strong>值得注意的是这个修改仅对当前用户生效</strong>。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;# 终端配色
export PS1=&#39;<span class="token entity" title="\\n">\\n</span>\\[<span class="token entity" title="\\e">\\e</span>[37;1m[\\]\\[<span class="token entity" title="\\e">\\e</span>[31;1m\\]\\u\\[<span class="token entity" title="\\e">\\e</span>[39;1m\\]@\\[<span class="token entity" title="\\e">\\e</span>[33;1m\\]\\H \\[<span class="token entity" title="\\e">\\e</span>[34;1m\\]\\w\\[<span class="token entity" title="\\e">\\e</span>[37;1m\\]]<span class="token entity" title="\\n">\\n</span>\\[<span class="token entity" title="\\e">\\e</span>[32;1m\\]<span class="token entity" title="\\\\">\\\\</span>$ \\[<span class="token entity" title="\\e">\\e</span>[0m\\]&#39;&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc

<span class="token builtin class-name">source</span> ~/.bashrc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置完成后，终端配色如下</p><p><img src="`+l+'" alt=""></p><h2 id="更新国内源" tabindex="-1"><a class="header-anchor" href="#更新国内源" aria-hidden="true">#</a> 更新国内源</h2>',19),p=e("code",null,"/etc/apt/sources.list",-1),h={href:"https://mirrors.ustc.edu.cn/help/ubuntu.html?highlight=ubuntu",target:"_blank",rel:"noopener noreferrer"},m=i(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>deb https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse

deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse

deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse

deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>如要用于其他版本，把 <code>jammy</code> 换成其他版本代号即可，对应关系如下：</p><ul><li><code>22.04</code>：<code>jammy</code></li><li><code>20.04</code>：<code>focal</code></li><li><code>18.04</code>：<code>bionic</code></li><li><code>16.04</code>：<code>xenial</code></li><li><code>14.04</code>：<code>trusty</code></li></ul></blockquote><p>修改完之后需要执行下面的命令更新索引。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token comment"># 更新索引</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="添加必要系统工具" tabindex="-1"><a class="header-anchor" href="#添加必要系统工具" aria-hidden="true">#</a> 添加必要系统工具</h2><p>安装 <code>vim</code> 编辑器、网络请求 <code>wget</code>、<code>curl</code>以及压缩与解压缩软件等。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token punctuation">\\</span>
  <span class="token function">vim</span> <span class="token punctuation">\\</span>
  <span class="token function">wget</span> <span class="token punctuation">\\</span>
  <span class="token function">curl</span> <span class="token punctuation">\\</span>
  cmake <span class="token punctuation">\\</span>
  g++ <span class="token punctuation">\\</span>
  tree <span class="token punctuation">\\</span>
  <span class="token function">git</span> <span class="token punctuation">\\</span>
  <span class="token function">zip</span> <span class="token punctuation">\\</span>
  <span class="token function">unzip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="设置时区" tabindex="-1"><a class="header-anchor" href="#设置时区" aria-hidden="true">#</a> 设置时区</h2><p>将服务器的时区设置为中国地区。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> timedatectl set-timezone Asia/Shanghai
<span class="token function">sudo</span> timedatectl set-local-rtc <span class="token number">0</span>
<span class="token function">sudo</span> timedatectl set-ntp <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置默认的编辑器" tabindex="-1"><a class="header-anchor" href="#配置默认的编辑器" aria-hidden="true">#</a> 配置默认的编辑器</h2><p>Ubuntu 系统默认的文件编辑器是 nano 而不是 Vim，那么怎么设置成 Vim 呢？</p><p>执行下面的命令选择将 Vim 设置为服务器默认的编辑器。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> update-alternatives <span class="token parameter variable">--config</span> editor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="添加新用户" tabindex="-1"><a class="header-anchor" href="#添加新用户" aria-hidden="true">#</a> 添加新用户</h2><p>初始情况通常会得到一个 root 账户，大多数云主机在安装 Ubuntu 系统后，默认都是用 root 账户登录的。</p><p>用 root 账户非常危险，还是养成好习惯，用普通用户登录，然后执行 sudo 比较安全点。</p><p>先用命令新建一个叫 <strong>ubuntu</strong> 的普通用户：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> adduser ubuntu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输入自定义用户密码后都输入回车使用默认即可。</p><p>创建完 ubuntu 用户后，如果想用它来执行一些系统级命令，可以把它加进 sudo 群组，这样就可以用 sudo 命令了：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">sudo</span> ubuntu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="配置-ssh-登录及-ssh-server-安全设定" tabindex="-1"><a class="header-anchor" href="#配置-ssh-登录及-ssh-server-安全设定" aria-hidden="true">#</a> 配置 SSH 登录及 SSH Server 安全设定</h2><h3 id="配置免密登录" tabindex="-1"><a class="header-anchor" href="#配置免密登录" aria-hidden="true">#</a> 配置免密登录</h3><p>为了避免每次使用上面新建的用户 ubuntu，登录服务器时都要输入密码，给登录用户设置 SSH Key 来登录，这样以后登录就不用输入密码。</p><p>使用 <code>su - ubuntu</code> 切换到 <code>ubuntu</code> 用户下进行下面的操作。</p><ol><li>执行下面的命令，建立 <code>authorized_keys</code> 文件。</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/.ssh
<span class="token function">touch</span> ~/.ssh/authorized_keys
<span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将本机个人电脑的 <code>id_rsa.pub</code> 文件内容复制进去，如果不存在就通过 <code>ssh-keygen</code> 生成一对公私钥。</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 可以通过手动拷贝也可以通过下面的命令进行自动拷贝</span>
ssh-copy-id ubuntu@ServerIP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>本地机器以后再登录服务器时就可以使用 <code>ssh ubuntu@ServerIP</code>。</p><h3 id="ssh安全设定" tabindex="-1"><a class="header-anchor" href="#ssh安全设定" aria-hidden="true">#</a> SSH安全设定</h3><p>编辑 SSH 配置文件<code>/etc/ssh/sshd_config</code>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/ssh/sshd_config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>把 PermitRootLogin 设置成 no，用于禁止 root 登录：</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PermitRootLogin no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>把 PasswordAuthentication 设置成 no，禁止密码登录，更安全：</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PasswordAuthentication no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>修改默认端口（选做）</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Port 2222
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><strong>注意</strong> 改成其他数字后，记得防火墙或者安全组配置的相关设置也需要同步更新。</p></blockquote><h3 id="重启-ssh-server" tabindex="-1"><a class="header-anchor" href="#重启-ssh-server" aria-hidden="true">#</a> 重启 SSH Server</h3><blockquote><p><strong>注意</strong> 在重启 SSH 服务之前，建议新建一个窗口尝试登录到服务器，避免一些错误操作导致无法连接到服务器。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart sshd.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="重启服务器" tabindex="-1"><a class="header-anchor" href="#重启服务器" aria-hidden="true">#</a> 重启服务器</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用上面的命令可以对服务器进行重启。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2>`,48),v={href:"https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04",target:"_blank",rel:"noopener noreferrer"};function b(g,k){const n=d("ExternalLinkIcon");return c(),r("div",null,[o,e("p",null,[s("如果使用国内的服务器需要更新软件源，这里使用清华的镜像源替换文件 "),p,s(" 内容，"),e("a",h,[s("参考文档"),a(n)]),s("。")]),m,e("ul",null,[e("li",null,[e("a",v,[s("Initial Server Setup with Ubuntu 20.04"),a(n)])])])])}const x=t(u,[["render",b],["__file","ubuntu-server-initialization.html.vue"]]);export{x as default};
