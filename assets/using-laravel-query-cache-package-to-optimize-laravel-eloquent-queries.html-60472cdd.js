import{_ as i,M as p,p as o,q as c,R as e,t as n,N as l,a1 as t}from"./framework-64ffeeb4.js";const u={},d={href:"https://github.com/Neurony/laravel-query-cache",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/barryvdh/laravel-debugbar",target:"_blank",rel:"noopener noreferrer"},k=["src"],h=["src"],m={href:"https://github.com/Neurony/laravel-query-cache",target:"_blank",rel:"noopener noreferrer"};function b(r,a){const s=p("ExternalLinkIcon");return o(),c("div",null,[a[7]||(a[7]=e("h1",{id:"使用-laravel-query-cache-来缓存数据库的-select-请求",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#使用-laravel-query-cache-来缓存数据库的-select-请求","aria-hidden":"true"},"#"),n(" 使用 laravel-query-cache 来缓存数据库的 SELECT 请求")],-1)),a[8]||(a[8]=e("p",null,"在实际的开发中，经常需要缓存查询数据库的结果以提升软件的性能。",-1)),e("p",null,[a[1]||(a[1]=n("这里使用",-1)),e("a",d,[a[0]||(a[0]=n("Neurony/laravel-query-cache",-1)),l(s)]),a[2]||(a[2]=n("来实现缓存，正如拓展包 README 中说到的，它专注于允许所有的查询操作，或者是在一次请求中重复的数据库查询。",-1))]),a[9]||(a[9]=t(`<blockquote><p>由于使用到了 laravel 的缓存 tag 标记，支持的缓存驱动有：<code>apc</code>, <code>array</code>, <code>redis</code>, <code>memcached</code>，这里推荐使用的缓存驱动是：<code>redis</code>。</p></blockquote><h2 id="安装和配置" tabindex="-1"><a class="header-anchor" href="#安装和配置" aria-hidden="true">#</a> 安装和配置</h2><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h3><p>执行下面的两条命令，安装拓展包和获取拓展包的配置文件。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">composer</span> require neurony/laravel-query-cache

php artisan vendor:publish <span class="token parameter variable">--provider</span><span class="token operator">=</span><span class="token string">&quot;Neurony\\QueryCache\\ServiceProvider&quot;</span> <span class="token parameter variable">--tag</span><span class="token operator">=</span><span class="token string">&quot;config&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h3><ul><li>修改项目环境文件 <code>.env</code> 中，添加如下环境变量：</li></ul><div class="language-dotenv line-numbers-mode" data-ext="dotenv"><pre class="language-dotenv"><code># The driver used for storing the cache keys that this package generates.
# This driver can differ from your main Laravel&#39;s CACHE_DRIVER.
QUERY_CACHE_DRIVER=redis

# Wether to cache absolutely all queries for the current request.
CACHE_ALL_QUERIES=true

# Wether to cache only the duplicated queries for the current request.
CACHE_DUPLICATE_QUERIES=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>修改要缓存的模型添加 traits</li></ul><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Database<span class="token punctuation">\\</span>Eloquent<span class="token punctuation">\\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Neurony<span class="token punctuation">\\</span>QueryCache<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>IsCacheable</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">YourModel</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">IsCacheable</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h2>`,11)),e("p",null,[a[4]||(a[4]=n("我们通过",-1)),e("a",v,[a[3]||(a[3]=n("barryvdh/laravel-debugbar",-1)),l(s)]),a[5]||(a[5]=n(" 来查看优化结果。",-1))]),a[10]||(a[10]=t(`<p>比如获取所有的用户数据</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>App<span class="token punctuation">\\</span>User</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2)),e("img",{src:r.$withBase("/images/languages/laravel/packages/using-laravel-query-cache-package-to-optimize-laravel-eloquent-queries/laravel-query-cache.png"),alt:""},null,8,k),a[11]||(a[11]=t(`<p>再比如获取关联数据缓存</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>App<span class="token punctuation">\\</span>User</span><span class="token operator">::</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2)),e("img",{src:r.$withBase("/images/languages/laravel/packages/using-laravel-query-cache-package-to-optimize-laravel-eloquent-queries/laravel-query-cache-relationship-data.png"),alt:""},null,8,h),a[12]||(a[12]=e("h2",{id:"参考地址",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#参考地址","aria-hidden":"true"},"#"),n(" 参考地址")],-1)),e("ul",null,[e("li",null,[e("a",m,[a[6]||(a[6]=n("Neurony/laravel-query-cache",-1)),l(s)])])])])}const y=i(u,[["render",b],["__file","using-laravel-query-cache-package-to-optimize-laravel-eloquent-queries.html.vue"]]);export{y as default};
