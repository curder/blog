import{_ as p,M as r,p as t,q as d,R as s,t as n,N as o,a1 as i}from"./framework-64ffeeb4.js";const l="/blog/assets/editor-code-style-php-psr-1-and-psr-2-a849fdfc.png",c="/blog/assets/editor-code-style-php-wrapping-and-braces-array-align-key-value-pairs-27423d12.png",u="/blog/assets/languages-and-frameworks-php-code-sniffer-for-current-project-configuration-ba9f75dc.png",g="/blog/assets/languages-and-frameworks-php-code-sniffer-for-current-project-configuration-phpcs-path-d2565822.png",h="/blog/assets/editor-inspections-php-code-sniffer-validation-psr2-e51e0134.png",m="/blog/assets/php-cs-fixer-external-tools-f6008158.png",v="/blog/assets/create-php-cs-fixer-tool-7281e4e4.png",b="/blog/assets/preferences-keymap-add-keyboard-shortcut-e80b144e.png",f="/blog/assets/preferences-keymap-add-keyboard-shortcut-shift-control-command-l-e2c9f5e8.png",k="/blog/assets/php-cs-fixer-refomat-file-432aee43.png",x={},P={href:"http://pear.php.net/package/PHP_CodeSniffer/",target:"_blank",rel:"noopener noreferrer"},S={href:"https://github.com/squizlabs/PHP_CodeSniffer",target:"_blank",rel:"noopener noreferrer"},R={href:"http://cs.sensiolabs.org/",target:"_blank",rel:"noopener noreferrer"},C={href:"https://github.com/FriendsOfPHP/PHP-CS-Fixer",target:"_blank",rel:"noopener noreferrer"};function y(F,e){const a=r("ExternalLinkIcon");return t(),d("div",null,[e[16]||(e[16]=s("h1",{id:"phpstorm如何配置php-code-sniffer和php-cs-fixer让php代码支持psr2规范",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#phpstorm如何配置php-code-sniffer和php-cs-fixer让php代码支持psr2规范","aria-hidden":"true"},"#"),n(" PHPStorm如何配置PHP-Code-Sniffer和PHP-CS-Fixer让PHP代码支持PSR2规范")],-1)),e[17]||(e[17]=s("h2",{id:"phpcs",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#phpcs","aria-hidden":"true"},"#"),n(" phpcs")],-1)),s("p",null,[s("a",P,[e[0]||(e[0]=n("PHP Code Sniffer",-1)),o(a)]),e[1]||(e[1]=n(" 简称 ",-1)),e[2]||(e[2]=s("code",null,"phpcs",-1)),e[3]||(e[3]=n(" ，用来检查PHP代码是否符合PSR-2，若完全符合则没有任何结果，若有任何错误将显示错误报告。",-1))]),e[18]||(e[18]=s("h3",{id:"安装",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#安装","aria-hidden":"true"},"#"),n(" 安装")],-1)),s("p",null,[e[5]||(e[5]=n("使用Composer命令进行全局安装",-1)),s("a",S,[e[4]||(e[4]=n("phpcs",-1)),o(a)]),e[6]||(e[6]=n("。",-1))]),e[19]||(e[19]=i(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">composer</span> global require <span class="token string">&#39;squizlabs/php_codesniffer=*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>phpcs <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出如下提示</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PHP_CodeSniffer version <span class="token number">3.2</span>.3 <span class="token punctuation">(</span>stable<span class="token punctuation">)</span> by Squiz <span class="token punctuation">(</span>http://www.squiz.net<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="检查psr-2命令行" tabindex="-1"><a class="header-anchor" href="#检查psr-2命令行" aria-hidden="true">#</a> 检查PSR-2命令行</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>phpcs <span class="token parameter variable">--standard</span><span class="token operator">=</span>PSR2 laravel/app
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>命令中<code>laravel</code>为项目名称，因为代码都在app目录下，所以直接指定<code>PHP Code Sniffer</code>检查<code>app</code>目录下所有的<code>.php</code>文件。</p></li><li><p><code>--standard=PSR2</code> <code>PHP Code Sniffer</code>预设的coding style为PEAR。</p></li></ul><p>输出类似如下的内容：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>FILE: /Volumes/codes/Desktop_Temp/201801/laravel/laravel-model-observers/app/Observers/PostObserver.php
-------------------------------------------------------------------------------------------------------
FOUND 9 ERRORS AFFECTING 9 LINES
-------------------------------------------------------------------------------------------------------
  7 | ERROR | [x] Opening brace should be on a new line
 12 | ERROR | [x] Opening brace should be on a new line
 16 | ERROR | [x] Opening brace should be on a new line
 20 | ERROR | [x] Opening brace should be on a new line
 25 | ERROR | [x] Opening brace should be on a new line
 29 | ERROR | [x] Opening brace should be on a new line
 33 | ERROR | [x] Opening brace should be on a new line
 38 | ERROR | [x] Opening brace should be on a new line
 52 | ERROR | [x] Expected 1 newline at end of file; 0 found
-------------------------------------------------------------------------------------------------------
PHPCBF CAN FIX THE 9 MARKED SNIFF VIOLATIONS AUTOMATICALLY
-------------------------------------------------------------------------------------------------------

Time: 104ms; Memory: 6Mb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若没有任何违反<code>PSR-2</code>之处，将没有任何回应，否则将出現类似如上的输出信息，告知用户那个文件有问题，错在哪些地方。其中FOUND为行数。</p><p>至此，phpcs安装完毕。</p><h2 id="php-cs-fixer" tabindex="-1"><a class="header-anchor" href="#php-cs-fixer" aria-hidden="true">#</a> php-cs-fixer</h2>`,13)),s("p",null,[s("a",R,[e[7]||(e[7]=n("PHP Coding Standards Fixer",-1)),o(a)]),e[8]||(e[8]=n(" 简称 ",-1)),e[9]||(e[9]=s("code",null,"php-cs-fixer",-1)),e[10]||(e[10]=n("。虽然",-1)),e[11]||(e[11]=s("code",null,"PHP Code Sniffer",-1)),e[12]||(e[12]=n("可以找出哪些代码不符合PSR-2。",-1))]),e[20]||(e[20]=s("p",null,[n("如果只有几个文件，那么手动修改就可以，若文件太多，就得依赖 "),s("code",null,"php-cs-fixer"),n(" 帮助修正。")],-1)),e[21]||(e[21]=s("h3",{id:"安裝",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#安裝","aria-hidden":"true"},"#"),n(" 安裝")],-1)),s("p",null,[e[14]||(e[14]=n("使用Composer命令进行全局安装 ",-1)),s("a",C,[e[13]||(e[13]=n("PHP-CS-Fixer",-1)),o(a)]),e[15]||(e[15]=n("。",-1))]),e[22]||(e[22]=i(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">composer</span> global require friendsofphp/php-cs-fixer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="测试-1" tabindex="-1"><a class="header-anchor" href="#测试-1" aria-hidden="true">#</a> 测试</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>php-cs-fixer  <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出如下提示</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PHP CS Fixer 2.12.0 Long Journey by Fabien Potencier and Dariusz Ruminski
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="修正psr-2命令行" tabindex="-1"><a class="header-anchor" href="#修正psr-2命令行" aria-hidden="true">#</a> 修正PSR-2命令行</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>php-cs-fixer fix laravel/app/ <span class="token parameter variable">--rules</span><span class="token operator">=</span>@PSR2 <span class="token parameter variable">--verbose</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p><code>laravel</code>为项目名称，因为我们写的代码都在<code>app</code>目录下，所以直接指定<code>PHP-CS-Fixer</code>帮我们检查<code>app</code>目录下所有的<code>.php</code>文件。</p></li><li><p><code>--rules=@PSR2</code>指定使用PSR-2标准来修正代码。</p></li><li><p><code>--verbose</code>表示<code>PHP-CS-Fixer</code>在执行时会显示出详细的结果。</p></li></ul><p>输出类似如下的内容：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SSSSSSSSSSSSSFSSSSSSS
Legend: ?-unknown, I-invalid file syntax, file ignored, S-Skipped, .-no changes, F-fixed, E-error
   1) app/Observers/PostObserver.php (braces, single_blank_line_at_eof)

Fixed all files in 0.015 seconds, 10.000 MB memory used
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>Lengend</code>表示在执行时，所执行过的动作。</p></li><li><p>如上图所示，表示修正过<code>PostObserver.php</code>。</p></li></ul><h2 id="phpstorm" tabindex="-1"><a class="header-anchor" href="#phpstorm" aria-hidden="true">#</a> PhpStorm</h2><p>PhpStorm对于PSR-2有以下支持:</p><ul><li>內建支持PSR-2语法。</li><li>可安装<code>PHP Code Sniffer</code>插件，提醒开发者所写代码是否符合PSR-2。</li><li>可安装<code>PHP Coding Standards Fixer</code>插件，将代码修正为PSR-2。</li></ul><h3 id="内建支持psr-2语法" tabindex="-1"><a class="header-anchor" href="#内建支持psr-2语法" aria-hidden="true">#</a> 内建支持PSR-2语法</h3><p><code>Preferences</code> -&gt; <code>Editor</code> -&gt; <code>Code Style</code> -&gt; <code>PHP : Set from…</code> -&gt; <code>Predefined Style</code> -&gt; <code>PSR1/PSR2</code></p><p><img src="`+l+'" alt=""></p><p>PSR-2 所没规定的 Code Style 如下图所示，可能会希望 array 的 key 与 value 能对齐，但这病不是 PSR-2 所规定的style，开发者可以根据需要自行设定。</p><p><img src="'+c+'" alt=""></p><h3 id="phpcs-1" tabindex="-1"><a class="header-anchor" href="#phpcs-1" aria-hidden="true">#</a> phpcs</h3><p><code>Preferences</code> -&gt; <code>Languages &amp; Frameworks</code> -&gt; <code>PHP</code> -&gt; <code>Code Sniffer</code></p><p><img src="'+u+'" alt=""></p><p>指定 <code>phpcs</code> 路徑 : <code>/Users/xiaoluo/.composer/vendor/bin/phpcs</code>，其中<code>/Users/xiaoluo/</code>为当前电脑的家目录。</p><p><img src="'+g+'" alt=""></p><p><code>Preferences</code> -&gt; <code>Editor</code> -&gt; <code>Inspections</code></p><ul><li><p>将<code>PHP Code Sniffer validation</code>选项打勾。</p></li><li><p>将<code>Coding standard</code>选<code>PSR2</code>。</p></li></ul><p><img src="'+h+'" alt=""></p><p>至此，phpStorm的phpcs配置完毕。</p><h3 id="php-cs-fixer-1" tabindex="-1"><a class="header-anchor" href="#php-cs-fixer-1" aria-hidden="true">#</a> php-cs-fixer</h3><p><code>Preferences</code> -&gt; <code>Tools</code> -&gt; <code>External Tools</code></p><p>按<code>+</code>新增<strong>External Tools</strong>。</p><p><img src="'+m+`" alt=""></p><p>在模板中添加如下内容：</p><ul><li><p><code>Name</code> : <strong>php-cs-fixer</strong></p></li><li><p><code>Description</code> : <strong>A tool to automatically fix PHP coding.</strong></p></li><li><p><code>Program</code> : <code>/Users/xiaoluo/.composer/vendor/bin/php-cs-fixer</code>，其中<code>/Users/xiaoluo/</code>为当前用户的家目录。</p></li><li><p><code>Parameters</code> : <code>--verbose fix $FileDir$/$FileName$ --config=/Users/xiaoluo/.phpcsfixer</code>，其中<code>/Users/xiaoluo/</code>为当前用户的家目录。</p></li><li><p><code>Working Directory</code> : <strong>$ProjectFileDir$</strong></p></li></ul><p>上述文件中包含一个<code>php-cs-fixer</code>的配置文件，<code>/Users/xiaoluo/.phpcsfixer</code>内容如下：</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$finder</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">PhpCsFixer<span class="token punctuation">\\</span>Finder</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">-&gt;</span><span class="token function">exclude</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;tests/&#39;</span><span class="token punctuation">)</span>
          <span class="token operator">-&gt;</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token class-name class-name-fully-qualified static-context">PhpCsFixer<span class="token punctuation">\\</span>Config</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">setRules</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;@PSR2&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;align_multiline_comment&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;no_trailing_whitespace&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;no_short_echo_tag&#39;</span><span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;array_syntax&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;syntax&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;short&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;no_unused_imports&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;ordered_imports&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;sortAlgorithm&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;length&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">setFinder</span><span class="token punctuation">(</span><span class="token variable">$finder</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+v+'" alt=""></p><h3 id="添加快捷键" tabindex="-1"><a class="header-anchor" href="#添加快捷键" aria-hidden="true">#</a> 添加快捷键</h3><p><code>Preferences</code> -&gt; <code>keymap</code> -&gt; 搜索<code>php-cs-fixer</code> -&gt; 右键点击<code>Add Keyboard Shortcut</code></p><p><img src="'+b+'" alt=""></p><h3 id="测试-2" tabindex="-1"><a class="header-anchor" href="#测试-2" aria-hidden="true">#</a> 测试</h3><p>测试phpstorm自带的Reformat Code</p><ul><li><p><code>⌃ + ⌥ + L</code> : 重新整理Coding Style。</p></li><li><p><code>⌃ + ⌥ + ⇧+ L</code> : 设定重新整理Coding Style方式。</p></li></ul><p>添加完以后快捷键为：</p><p><img src="'+f+'" alt=""></p><h4 id="一些简单的格式化设置" tabindex="-1"><a class="header-anchor" href="#一些简单的格式化设置" aria-hidden="true">#</a> 一些简单的格式化设置</h4><p>使用命令<code>Command + Shift + a</code>后输入：&#39;Show Reformat File Dialog&#39;关键字，后看到下面的配置</p><p><img src="'+k+'" alt=""></p><ul><li><p><code>Optimize imports</code> : 没用到的namespace，use会自动移除。</p></li><li><p><code>Rearrange code</code> : 会自动依据Code Style的Arrangement规格将代码重新排序。</p></li></ul>',49))])}const H=p(x,[["render",y],["__file","how-to-use-phpstorm-configures-php-code-sniffer-and-php-cs-fixer-to-support-psr2-specification.html.vue"]]);export{H as default};
