(self.webpackChunkblog=self.webpackChunkblog||[]).push([[6105],{6370:(e,n,s)=>{"use strict";s.r(n),s.d(n,{data:()=>a});const a={key:"v-79c766f3",path:"/os/centos/centos7/centos-7-uses-yum-way-to-install-and-configure-php-fpm.html",title:"CentOS7使用yum方式安装和配置php-fpm",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"使用webtatic仓库安装PHP",slug:"使用webtatic仓库安装php",children:[{level:3,title:"安装webstatic仓库",slug:"安装webstatic仓库",children:[]},{level:3,title:"检查webstatic仓库安装结果",slug:"检查webstatic仓库安装结果",children:[]},{level:3,title:"使用yum命令安装php-fpm",slug:"使用yum命令安装php-fpm",children:[]},{level:3,title:"检查php-fpm是否安装成功",slug:"检查php-fpm是否安装成功",children:[]},{level:3,title:"使用remi仓库",slug:"使用remi仓库",children:[]}]},{level:2,title:"配置php-fpm",slug:"配置php-fpm",children:[{level:3,title:"修改 php.ini",slug:"修改-php-ini",children:[]},{level:3,title:"修改www.conf",slug:"修改www-conf",children:[]},{level:3,title:"系统守护进程方式启动php-fpm",slug:"系统守护进程方式启动php-fpm",children:[]},{level:3,title:"使用supervisord管理进程",slug:"使用supervisord管理进程",children:[]},{level:3,title:"检查php-fpm",slug:"检查php-fpm",children:[]}]},{level:2,title:"参考链接",slug:"参考链接",children:[]}],filePathRelative:"os/centos/centos7/centos-7-uses-yum-way-to-install-and-configure-php-fpm.md",git:{updatedTime:1639727659e3,contributors:[]}}},9867:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>W});var a=s(6252);const p=(0,a.uE)('<h1 id="centos7使用yum方式安装和配置php-fpm" tabindex="-1"><a class="header-anchor" href="#centos7使用yum方式安装和配置php-fpm" aria-hidden="true">#</a> CentOS7使用yum方式安装和配置php-fpm</h1><p>目前常用的两种yum方式安装php-fpm，分别是<code>webtatic</code>仓库和<code>remi</code>仓库，在实际的使用中选择一种即可。</p><p>下面以安装 PHP 7.1 为例。</p><h2 id="使用webtatic仓库安装php" tabindex="-1"><a class="header-anchor" href="#使用webtatic仓库安装php" aria-hidden="true">#</a> 使用webtatic仓库安装PHP</h2><h3 id="安装webstatic仓库" tabindex="-1"><a class="header-anchor" href="#安装webstatic仓库" aria-hidden="true">#</a> 安装webstatic仓库</h3><p>在CentOS基础库中不存在PHP 7.1，我们需要从名为<code>webtatic</code>的第三方仓库中安装它。</p><p>使用如下rpm命令安装<code>webtatic</code>仓库。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y epel-release\n<span class="token function">sudo</span> <span class="token function">rpm</span> -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>如果执行上面的命令一直报错<code>curl: (35) Encountered end of file</code>，可以尝试将上面的https协议改成http协议获取rpm源。</p></blockquote>',9),l=(0,a.Uk)("其他版本下载可以查看这里："),t={href:"https://webtatic.com/projects/yum-repository/",target:"_blank",rel:"noopener noreferrer"},c=(0,a.Uk)("webtatic仓库"),o=(0,a.uE)('<h3 id="检查webstatic仓库安装结果" tabindex="-1"><a class="header-anchor" href="#检查webstatic仓库安装结果" aria-hidden="true">#</a> 检查webstatic仓库安装结果</h3><p>使用下面的命令可以查看<code>webstatic</code>仓库是否安装成功。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum repolist\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',3),i=(0,a.uE)('<h3 id="使用yum命令安装php-fpm" tabindex="-1"><a class="header-anchor" href="#使用yum命令安装php-fpm" aria-hidden="true">#</a> 使用yum命令安装php-fpm</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> -y php71w php71w-gd php71w-curl php71w-common php71w-cli php71w-mysql php71w-mbstring php71w-fpm php71w-xml php71w-pdo php71w-zip\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>执行完上面的命令后，CentOS系统上已经安装了PHP 7.1。</p><h3 id="检查php-fpm是否安装成功" tabindex="-1"><a class="header-anchor" href="#检查php-fpm是否安装成功" aria-hidden="true">#</a> 检查php-fpm是否安装成功</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>php -v\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',5),r=(0,a.uE)('<blockquote><p><strong>注意：</strong> 如果想更换到<code>php5.6</code>或<code>7.0</code>版本, 直接把上面的<code>php71w</code>换成<code>php56w</code>或者<code>php70w</code>就可以了。 重装<code>php-fp</code>m时，记得使用<code>sudo systemctl stop php-fpm</code>先关闭<code>php-fpm</code>进程，然后再使用 <code>yum uninstall php71w php71w-curl php71w-common php71w-cli php71w-mysql php71w-mbstring php71w-fpm php71w-xml php71w-pdo php71w-zip</code> 命令进行移除后，并再次执行<code>yum install</code>命令进行重装。</p></blockquote><h3 id="使用remi仓库" tabindex="-1"><a class="header-anchor" href="#使用remi仓库" aria-hidden="true">#</a> 使用remi仓库</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">wget</span> https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\n<span class="token function">sudo</span> <span class="token function">wget</span> http://rpms.remirepo.net/enterprise/remi-release-7.rpm\n<span class="token function">sudo</span> <span class="token function">rpm</span> -Uvh remi-release-7.rpm epel-release-latest-7.noarch.rpm\n\n<span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils\n<span class="token function">sudo</span> yum-config-manager --enable remi-php71\n\n<span class="token function">sudo</span> yum <span class="token function">install</span> -y php71\n\n<span class="token function">sudo</span> yum <span class="token function">install</span> -y php php-mcrypt php-xml php-mbstring php-cli php-gd php-curl php-mysql php-ldap php-zip php-fileinf php-fpm\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>如果执行上面的命令提示：<code>-bash: wget: command not found</code>，则使用<code>sudo yum install -y wget</code>安装一下<code>wget</code>命令。</p></blockquote><h2 id="配置php-fpm" tabindex="-1"><a class="header-anchor" href="#配置php-fpm" aria-hidden="true">#</a> 配置php-fpm</h2><p><strong>注意:</strong> 在配置中修改的用户和用户组会设置成跟web服务器的保持一致即可。</p><p>如果不存在web服务器，可以使用<code>nobody</code>替代。</p><h3 id="修改-php-ini" tabindex="-1"><a class="header-anchor" href="#修改-php-ini" aria-hidden="true">#</a> 修改 php.ini</h3><p>通过使用<code>vim</code>编辑配置文件<code>php.ini</code>来配置PHP，默认的主配置文件存放位置在<code>/etc/php.ini</code>。</p><p>在文件中找如如下行，取消它的行注释并将值更改为<strong>0</strong>。</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">cgi.fix_pathinfo</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>修改完成后，保存文件并退出编辑器。</p><h3 id="修改www-conf" tabindex="-1"><a class="header-anchor" href="#修改www-conf" aria-hidden="true">#</a> 修改www.conf</h3><p>现在编辑<code>php-fpm</code>文件<code>/etc/php-fpm.d/www.conf</code>。</p><ul><li><code>php-fpm</code>将在用户和组<code>nginx</code>下运行，将下面两行的值更改为<code>nginx</code>，这里用户和用户组请保持与<code>Nginx</code>服务器的用户和用户组一致。</li></ul><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">user</span> <span class="token punctuation">=</span> <span class="token value attr-value">nginx</span>\n<span class="token key attr-name">group</span> <span class="token punctuation">=</span> <span class="token value attr-value">nginx</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>php-fpm</code>将在套接字文件下运行，而不是使用服务器端口，将<code>listen</code>值更改为路径<code>/run/php-fpm/php-fpm.sock</code>。</li></ul><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">listen</span> <span class="token punctuation">=</span> <span class="token value attr-value">/run/php-fpm/php-fpm.sock</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>套接字文件所有者将是<code>nginx</code>用户，这里用户和用户组请保持与<code>Nginx</code>服务器的用户和用户组一致。权限模式为<code>660</code>，取消注释并更改所有值。</li></ul><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">listen.owner</span> <span class="token punctuation">=</span> <span class="token value attr-value">nginx</span>\n<span class="token key attr-name">listen.group</span> <span class="token punctuation">=</span> <span class="token value attr-value">nginx</span>\n<span class="token key attr-name">listen.mode</span>  <span class="token punctuation">=</span> <span class="token value attr-value">0660</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>对于环境变量，取消注释这些行并设置值。</li></ul><div class="language-dotenv ext-dotenv line-numbers-mode"><pre class="language-dotenv"><code>env[HOSTNAME] = $HOSTNAME\nenv[PATH] = /usr/local/bin:/usr/bin:/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="系统守护进程方式启动php-fpm" tabindex="-1"><a class="header-anchor" href="#系统守护进程方式启动php-fpm" aria-hidden="true">#</a> 系统守护进程方式启动php-fpm</h3><p>执行下面的命令启动<code>php-fpm</code>并使其在CentOS系统启动时运行。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start php-fpm <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> php-fpm\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="使用supervisord管理进程" tabindex="-1"><a class="header-anchor" href="#使用supervisord管理进程" aria-hidden="true">#</a> 使用supervisord管理进程</h3>',26),d=(0,a.Uk)("supervisord的进程管理"),u={href:"/os/centos/how-to-use-supervisord-manager-processes.md",target:"_blank",rel:"noopener noreferrer"},h=(0,a.Uk)("参考这里"),m=(0,a.Uk)("。"),b=(0,a.uE)('<h4 id="修改php-fpm在前台运行" tabindex="-1"><a class="header-anchor" href="#修改php-fpm在前台运行" aria-hidden="true">#</a> 修改php-fpm在前台运行</h4><ul><li>使用<code>sed</code>命令进行修改</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sed</span> -i <span class="token string">&#39;s/^daemonize = yes/daemonize = no/g&#39;</span> /etc/php-fpm.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>检查php-fpm配置</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">grep</span> daemonize /etc/php-fpm.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>输出：<code>daemonize = no</code>即表示设置成功。</p><h4 id="php-fpm的supervisord配置文件" tabindex="-1"><a class="header-anchor" href="#php-fpm的supervisord配置文件" aria-hidden="true">#</a> php-fpm的supervisord配置文件</h4><p>默认的 supervisord 的进程文件保存在<code>/etc/supervisord.d/php.ini</code>，内容如下：</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">program:php</span><span class="token punctuation">]</span></span>\n<span class="token key attr-name">command</span><span class="token punctuation">=</span><span class="token value attr-value">/sbin/php-fpm</span>\n<span class="token key attr-name">user</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>\n<span class="token key attr-name">autostart</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>\n<span class="token key attr-name">autorestart</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>\n<span class="token key attr-name">stdout_logfile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/php.out.log</span>\n<span class="token key attr-name">stderr_logfile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/php.err.log</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="重载配置" tabindex="-1"><a class="header-anchor" href="#重载配置" aria-hidden="true">#</a> 重载配置</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>supervisorctl reread <span class="token operator">&amp;&amp;</span> supervisorctl update\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>执行完上面的命令，可以看到控制台会输出如下结果</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>php: available\nphp: added process group\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>如果在启动<code>php-fpm</code>的时候，报错<code>ERROR: unable to bind listening socket for address &#39;/run/php-fpm/php-fpm.sock&#39;: No such file or directory (2)</code>。 使用命令<code>mkdir -pv /run/php-fpm/</code>手动创建目录。</p></blockquote><p>至此使用 <code>supervisord</code> 管理<code>php-fpm</code>进程已经完成。</p><h3 id="检查php-fpm" tabindex="-1"><a class="header-anchor" href="#检查php-fpm" aria-hidden="true">#</a> 检查php-fpm</h3><h4 id="检查进程" tabindex="-1"><a class="header-anchor" href="#检查进程" aria-hidden="true">#</a> 检查进程</h4><p>检查系统进程使用<code>ps</code>命令。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">ps</span> aux <span class="token operator">|</span><span class="token function">grep</span> php-fpm\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',19),f=(0,a.uE)('<h4 id="检查套接字" tabindex="-1"><a class="header-anchor" href="#检查套接字" aria-hidden="true">#</a> 检查套接字</h4><p>php-fpm在套接字文件下运行，使用以下命令检查。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">netstat</span> -pl <span class="token operator">|</span> <span class="token function">grep</span> php-fpm.sock\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>如果得到<code>“-bash: netstat: command not found”</code>错误，请安装<code>net-tools</code>软件包，如下所示： <code>sudo yum -y install net-tools</code></p></blockquote>',4),g=(0,a.Wm)("p",null,[(0,a.Uk)("至此，CentOS下安装"),(0,a.Wm)("code",null,"php-fpm"),(0,a.Uk)("就安装好了。")],-1),v=(0,a.Wm)("h2",{id:"参考链接",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#参考链接","aria-hidden":"true"},"#"),(0,a.Uk)(" 参考链接")],-1),k={href:"https://linuxize.com/post/install-php-7-on-centos-7/",target:"_blank",rel:"noopener noreferrer"},w=(0,a.Uk)("Install PHP 7 on CentOS 7"),y={href:"https://www.cyberciti.biz/faq/how-to-install-php-7-2-on-centos-7-rhel-7/",target:"_blank",rel:"noopener noreferrer"},x=(0,a.Uk)("How to install PHP 7.2 on CentOS 7/RHEL 7"),W={render:function(e,n){const s=(0,a.up)("OutboundLink");return(0,a.wg)(),(0,a.j4)(a.HY,null,[p,(0,a.Wm)("p",null,[l,(0,a.Wm)("a",t,[c,(0,a.Wm)(s)])]),o,(0,a.Wm)("img",{src:e.$withBase("/images/os/centos7/centos-7-uses-yum-way-to-install-and-configure-php-fpm/webtatic-rpm.png"),alt:""},null,8,["src"]),i,(0,a.Wm)("img",{src:e.$withBase("/images/os/centos7/centos-7-uses-yum-way-to-install-and-configure-php-fpm/check-php-fpm-install-by-webtatic-success.png"),alt:""},null,8,["src"]),r,(0,a.Wm)("p",null,[d,(0,a.Wm)("a",u,[h,(0,a.Wm)(s)]),m]),b,(0,a.Wm)("img",{src:e.$withBase("/images/os/centos7/centos-7-uses-yum-way-to-install-and-configure-php-fpm/php-fpm-process-check.png"),alt:""},null,8,["src"]),f,(0,a.Wm)("img",{src:e.$withBase("/images/os/centos7/centos-7-uses-yum-way-to-install-and-configure-php-fpm/php-fpm-sock-status-check.png"),alt:""},null,8,["src"]),g,v,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("a",k,[w,(0,a.Wm)(s)])])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("a",y,[x,(0,a.Wm)(s)])])])])],64)}}}}]);