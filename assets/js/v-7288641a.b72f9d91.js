(self.webpackChunkblog=self.webpackChunkblog||[]).push([[348],{2501:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-7288641a",path:"/others/use-docker-deploy-gogs.html",title:"使用docker部署私有Gogs服务",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"环境依赖",slug:"环境依赖",children:[]},{level:2,title:"安装 docker 和 docker-compsoe",slug:"安装-docker-和-docker-compsoe",children:[{level:3,title:"安装docker",slug:"安装docker",children:[]},{level:3,title:"安装docker-composer",slug:"安装docker-composer",children:[]},{level:3,title:"启动 Docker 后台服务",slug:"启动-docker-后台服务",children:[]},{level:3,title:"测试安装效果",slug:"测试安装效果",children:[]}]},{level:2,title:"配置docker-compose",slug:"配置docker-compose",children:[]},{level:2,title:"HTTP运行Gogs",slug:"http运行gogs",children:[]},{level:2,title:"参考链接",slug:"参考链接",children:[]}],filePathRelative:"others/use-docker-deploy-gogs.md",git:{updatedTime:1627991201e3,contributors:[]}}},1657:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>y});var e=a(6252);const p=(0,e.uE)('<h1 id="使用docker部署私有gogs服务" tabindex="-1"><a class="header-anchor" href="#使用docker部署私有gogs服务" aria-hidden="true">#</a> 使用docker部署私有Gogs服务</h1><h2 id="环境依赖" tabindex="-1"><a class="header-anchor" href="#环境依赖" aria-hidden="true">#</a> 环境依赖</h2><ul><li><p>docker</p></li><li><p>docker-compose</p></li><li><p>nginx</p></li><li><p>域名<code>gogs.domain.com</code></p></li></ul><p>服务器环境使用<code>CentOS Linux release 7.4.1708 (Core)</code>。</p><p>安装之前请准备一个<code>gogs.domain.com</code>域名，并将其指向服务器IP地址。</p><blockquote><p>不需要在本地提前安装好 <code>MySQL</code>，这里通过 <code>Docker</code> 安装<code>gogs-server</code>和<code>MySQL</code>。</p></blockquote><h2 id="安装-docker-和-docker-compsoe" tabindex="-1"><a class="header-anchor" href="#安装-docker-和-docker-compsoe" aria-hidden="true">#</a> 安装 docker 和 docker-compsoe</h2><h3 id="安装docker" tabindex="-1"><a class="header-anchor" href="#安装docker" aria-hidden="true">#</a> 安装docker</h3><p>Docker 软件包和依赖包已经包含在默认的 CentOS-Extras 软件源里，安装命令如下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> docker\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="安装docker-composer" tabindex="-1"><a class="header-anchor" href="#安装docker-composer" aria-hidden="true">#</a> 安装docker-composer</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.19.0/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> -o /usr/local/bin/docker-compose\n\n<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>',12),l=(0,e.Uk)("更多的安装请参考"),c={href:"https://docs.docker.com/compose/install/#install-compose",target:"_blank",rel:"noopener noreferrer"},o=(0,e.Uk)("Install Compose"),t=(0,e.uE)('<h3 id="启动-docker-后台服务" tabindex="-1"><a class="header-anchor" href="#启动-docker-后台服务" aria-hidden="true">#</a> 启动 Docker 后台服务</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl start docker\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="测试安装效果" tabindex="-1"><a class="header-anchor" href="#测试安装效果" aria-hidden="true">#</a> 测试安装效果</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker --version\ndocker-compose --version\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="配置docker-compose" tabindex="-1"><a class="header-anchor" href="#配置docker-compose" aria-hidden="true">#</a> 配置docker-compose</h2><p>直接上<code>docker-compose.yaml</code>文件内容：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;2&#39;</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n\n  <span class="token key atrule">mysql-gogs</span><span class="token punctuation">:</span>\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>gogs\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.13\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-data:/var/lib/mysql&quot;</span>\n    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>MYSQL_ROOT_PASSWORD<span class="token punctuation">}</span>\n      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>MYSQL_DATABASE<span class="token punctuation">}</span>\n      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>MYSQL_USER<span class="token punctuation">}</span>\n      <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>MYSQL_PASSWORD<span class="token punctuation">}</span>\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> gogs\n  <span class="token key atrule">gogs</span><span class="token punctuation">:</span>\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gogs\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> gogs/gogs<span class="token punctuation">:</span>latest\n    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> mysql<span class="token punctuation">-</span>gogs\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;${SSH_PORT}:22&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;${GOGS_PORT}:3000&quot;</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./gogs<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/data\n    <span class="token key atrule">links</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> mysql<span class="token punctuation">-</span>gogs\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;RUN_CROUD=true&quot;</span>\n      <span class="token punctuation">-</span> SSH_PORT=$<span class="token punctuation">{</span>SSH_PORT<span class="token punctuation">}</span>\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> gogs\n\n<span class="token key atrule">networks</span><span class="token punctuation">:</span>\n  <span class="token key atrule">gogs</span><span class="token punctuation">:</span>\n    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge\n\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  <span class="token key atrule">gogs-data</span><span class="token punctuation">:</span>\n    <span class="token key atrule">driver</span><span class="token punctuation">:</span> local\n  <span class="token key atrule">mysql-data</span><span class="token punctuation">:</span>\n    <span class="token key atrule">driver</span><span class="token punctuation">:</span> local\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>其中上面使用到的环境变量需要放在文件名在<code>.env</code>的文件中，并保证与<code>docker-compose.yaml</code>文件在同一目录下，大致内容如下：</p><div class="language-dotenv ext-dotenv line-numbers-mode"><pre class="language-dotenv"><code>MYSQL_ROOT_PASSWORD=mysql_root_password\nMYSQL_DATABASE=gogs\nMYSQL_USER=gogs\nMYSQL_PASSWORD=gogs_password\n\nGOGS_PORT=3000\nSSH_PORT=10022\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>执行命令运行docker。</p>',10),r=(0,e.Uk)("执行命令前安装"),u={href:"https://cr.console.aliyun.com/?spm=5176.100239.blogcont57268.20.ik4KA5#/accelerator",target:"_blank",rel:"noopener noreferrer"},i=(0,e.Uk)("阿里云加速器"),k=(0,e.Uk)("来加速安装过程。"),d=(0,e.Wm)("div",{class:"language-text ext-text line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-text"},[(0,e.Wm)("code",null,"docker-compose up -d\n")]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br")])],-1),m=(0,e.Wm)("h2",{id:"http运行gogs",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#http运行gogs","aria-hidden":"true"},"#"),(0,e.Uk)(" HTTP运行Gogs")],-1),b=(0,e.Wm)("p",null,"第一次在浏览器运行Gogs会需要填写一些初始化数据库配置等参数。如下图：",-1),g=(0,e.uE)('<p><code>nginx</code>配置文件内容</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment">#server {</span>\n<span class="token comment">#    listen      80; ## listen for ipv4</span>\n<span class="token comment">#    server_name   gogs.domain.com;</span>\n<span class="token comment">#    return      301 https://$server_name$request_uri;</span>\n<span class="token comment">#}</span>\n<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n    <span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">300M</span></span><span class="token punctuation">;</span>\n\n    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span> <span class="token comment"># 或者 443，如果你使用 HTTPS 的话</span>\n\n    <span class="token comment"># SSL support</span>\n    <span class="token comment"># ssl on;</span>\n    <span class="token comment"># ssl_certificate      ./ssl/fullchain.cer;</span>\n    <span class="token comment"># ssl_certificate_key  ./ssl/domain.com.key;</span>\n\n    <span class="token directive"><span class="token keyword">server_name</span> gogs.domain.com</span><span class="token punctuation">;</span>\n\n    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>\n         <span class="token comment"># 如果你希望通过子路径访问，此处修改为子路径，注意以 / 开头并以 / 结束</span>\n        <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000/</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接" aria-hidden="true">#</a> 参考链接</h2>',3),h={href:"https://github.com/Unknwon/wuwen.org/issues/12",target:"_blank",rel:"noopener noreferrer"},v=(0,e.Uk)("使用 HTTPS 部署 Gogs"),y={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[p,(0,e.Wm)("blockquote",null,[(0,e.Wm)("p",null,[l,(0,e.Wm)("a",c,[o,(0,e.Wm)(a)])])]),t,(0,e.Wm)("blockquote",null,[(0,e.Wm)("p",null,[r,(0,e.Wm)("a",u,[i,(0,e.Wm)(a)]),k]),d]),m,b,(0,e.Wm)("img",{src:n.$withBase("/images/others/use-docker-deploy-gogs/gogs-install.png"),alt:""},null,8,["src"]),g,(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("a",h,[v,(0,e.Wm)(a)])])])],64)}}}}]);