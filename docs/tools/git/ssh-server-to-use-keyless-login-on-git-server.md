# GitæœåŠ¡å™¨ä¸Šä½¿ç”¨SSHåè®®æˆæƒå…å¯†ç ç™»å½•

åœ¨MaxOSXå’ŒCentOSä¸Šæµ‹è¯•å¯ä»¥é€šè¿‡ï¼ŒWindowsç³»ç»Ÿå¯ä»¥å‚è€ƒå®ç°æ€è·¯ã€‚

## åŸºæœ¬çš„SSHé…ç½®

### ä½¿ç”¨å‘½ä»¤ç”ŸæˆSSHå…¬é’¥å’Œç§˜é’¥

```bash
ssh-keygen -t rsa -C "your_email@example.com" -f your_email_rsa
```

æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šåœ¨å½“å‰ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š`~/.ssh/your_email_rsa`ç§˜é’¥å’Œ`~/.ssh/your_email_rsa.pub`å…¬é’¥ã€‚

> å…¶ä¸­å‚æ•°`-C`çš„ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªå¤‡æ³¨ï¼Œ`-f`å‚æ•°çš„ä½œç”¨æ˜¯æŒ‡å®šè¦ç”Ÿæˆæ–‡ä»¶åã€‚æ›´å¤šå‚æ•°å¯ä»¥ä½¿ç”¨`ssh-keygen --help`æŸ¥çœ‹ã€‚

### æ‹·è´å†…å®¹åˆ°ç¬¬ä¸‰æ–¹Gitå¹³å°

#### è·å–SSHå…¬é’¥å†…å®¹

é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œè·å–ä¸Šé¢ä½¿ç”¨`ssh-keygen`å‘½ä»¤ç”Ÿæˆçš„å…¬é’¥å†…å®¹å¹¶æ‹·è´ã€‚

```bash
cat ~/.ssh/your_email_rsa.pub
```

#### å°†å…¬é’¥å†…å®¹å¤åˆ¶è‡³ä»£ç æ‰˜ç®¡å¹³å°ä¸Š

è¿™é‡Œä»¥GitHubä¸ºä¾‹ï¼Œè¿›å…¥ [GiHub](https://github.com/) --> [Setting](https://github.com/settings/profile)
--> [SSH and GPG keys](https://github.com/settings/keys) ï¼Œç‚¹å‡» [New SSH key](https://github.com/settings/ssh/new) æŒ‰é’®ã€‚

- åœ¨ **Title** æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä¸€ä¸ªæ ‡è¯†å­—ç¬¦
- åœ¨ **Key** æ–‡æœ¬æ¡†ç²˜è´´åˆšæ‰å¤åˆ¶çš„å…¬é’¥å­—ç¬¦ä¸²ï¼Œå³`YOUR_NAME.pub`æ–‡ä»¶å†…å®¹ï¼ŒæŒ‰ `Add SSH Key` æŒ‰é’®å®Œæˆæ“ä½œã€‚

<img :src="$withBase('/images/tools/git/ssh-server-to-use-keyless-login-on-git-server/github-save-ssh-key.png')" alt="å°†å…¬é’¥å†…å®¹å¤åˆ¶åˆ°ä»£ç æ‰˜ç®¡å¹³å°">

### éªŒè¯æ˜¯å¦æˆåŠŸæˆæƒ

åœ¨ä½¿ç”¨ `git` å‘½ä»¤ä¸æœåŠ¡ç«¯è¿›è¡Œäº¤äº’ä¹‹å‰ï¼Œå¯ä»¥å…ˆéªŒè¯ä¸‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯å¦æ¡æ‰‹æˆåŠŸã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤éªŒè¯ SSH å…¬é’¥æ˜¯å¦æ­£å¸¸ã€‚

```bash
ssh -T git@github.com
```

å¦‚æœæ­£å¸¸çš„æƒ…å†µä¼šæç¤º ` Hi curder-blog! You've successfully authenticated, but GitHub does not provide shell access.`

ä½†æ˜¯åœ¨æ–°è£…çš„æœºå™¨ä¸Šå‘ç”Ÿäº†ä¸€äº›é—®é¢˜ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯ `Permission denied (publickey).`å¾ˆæ˜æ˜¾æ˜¯å¤±è´¥äº†ã€‚

ä¿®æ”¹SSHé…ç½®æ–‡ä»¶ï¼Œ`vim ~/.ssh/config`ï¼ˆå¦‚æœæ²¡æœ‰æ­¤æ–‡ä»¶ï¼Œå¯ä»¥æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥`touch ~/.ssh/config`ç”Ÿæˆæ­¤æ–‡ä»¶ï¼‰ï¼Œé…ç½®åŸŸåå¹¶æŒ‡å®šè®¤è¯æ–‡ä»¶ã€‚

```text
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/your_email_rsa
    Port 22
```

> å¦‚æœ git ä»“åº“æœºå™¨çš„sshç«¯å£ä¸æ˜¯é»˜è®¤çš„`22`ï¼Œéœ€è¦é…ç½®SSHé…ç½®`~/.ssh/config`çš„**Port**çš„å€¼ä¸ºå½“å‰ç¯å¢ƒçš„å€¼ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨sshè¿æ¥çš„æ—¶å€™ï¼Œä½¿ç”¨çš„è®¤è¯æ–‡ä»¶æ˜¯æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„ï¼Œç‰¹åˆ«æ³¨æ„è¿™é‡Œçš„`Host`ã€`HostName`ã€`Port`å’Œ`IdentityFile`ï¼Œä¸è¦å†™é”™ã€‚

å†æ¬¡æ‰§è¡Œ`ssh -T git@github.com`çš„æ—¶å€™ï¼ŒæŠ¥é”™`Bad owner or permissions on ~/.ssh/config`ã€‚

ä»é”™è¯¯æç¤ºä¸éš¾çœ‹å‡ºæ˜¯æƒé™å‡ºäº†é—®é¢˜ï¼Œé€šè¿‡å‘½ä»¤æˆæƒ`chown $USER ~/.ssh/config && chmod 644 ~/.ssh/config`ã€‚

å†æ¬¡æ‰§è¡Œ`ssh -T git@github.com`åˆ™è¿”å›æ­£å¸¸çš„æ¬¢è¿ä¿¡æ¯ã€‚

è‡³æ­¤ï¼ŒGITæœåŠ¡å™¨ä¸Šä½¿ç”¨SSHåè®®æˆæƒå…å¯†é’¥ç™»å½•å·²ç»å®Œæˆï¼Œå¯ä»¥æ¬¢å¿«çš„ `pull && push`å•¦ğŸ˜ğŸ˜

ä¸Šé¢è¯´åˆ°çš„æƒ…å†µæ˜¯ä¸€ä¸ªGitHubå¯¹åº”ä¸€ä¸ªå…¬é’¥ã€ç§é’¥ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬éœ€è¦åœ¨å…¶ä»–è®¾å¤‡ä¸Šä¹Ÿèƒ½å…å¯†ç ç™»å½•æˆæƒå‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯åœ¨å…¶ä»–è®¾å¤‡ä¸Šä½¿ç”¨ä¸Šé¢çš„æ–¹å¼é‡æ–°èµ°ä¸€éæµç¨‹åº”è¯¥ä¹Ÿèƒ½æˆåŠŸã€‚

ä½†æ˜¯å®é™…çš„æƒ…å†µå¾€å¾€æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œè¿™é‡Œä¾ç„¶ä»¥ GitHub ä¸ºä¾‹ã€‚

1. æ‹¥æœ‰å¤šä¸ª GitHub è´¦æˆ·
2. å·²ç»é…ç½®äº†è´¦æˆ·å…¬é’¥ï¼Œè¿˜éœ€è¦ç»™éè‡ªå·±è´¦æˆ·ä¸‹çš„é¡¹ç›®é…ç½®éƒ¨ç½²å…¬é’¥

æ­¤æ—¶ï¼Œåˆåº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ

## åœ¨åŒä¸€è®¾å¤‡ä¸Šé…ç½®å¤šä¸ªå…¬é’¥

> ä¸€ä¸ªå…¬é’¥åªèƒ½é…ç½®ä¸€ä¸ªè´¦æˆ·ï¼Œä¸€ä¸ªè´¦æˆ·å¯ä»¥å…³è”å¤šä¸ªå…¬é’¥ã€‚æ¯”å¦‚å½“æ‹¥æœ‰å¤šä¸ªè®¾å¤‡ï¼Œæ¯ä¸ªè®¾å¤‡ä¸Šå¯ä»¥ç”Ÿæˆä¸€ä¸ªå…¬é’¥å’Œå¯¹åº”çš„è´¦æˆ·ç›¸å…³è”ï¼Œå…³è”åæ­¤å…¬é’¥ä¾¿ä¸èƒ½ä¸å…¶å®ƒçš„è´¦æˆ·æˆ–é¡¹ç›®è¿›è¡Œå…³è”ã€‚å¦‚æœéœ€è¦æ›´æ¢å…³è”è´¦æˆ·ï¼Œè¯·å…ˆåœ¨å…¬é’¥è®¾ç½®é‡Œè§£ç»‘å…¬é’¥ã€‚

### ç”Ÿæˆç¬¬äºŒä¸ªå…¬é’¥

```bash
ssh-keygen -t rsa -C "your_secondemail@email.com" -f ~/.ssh/second_rsa
```

> æ³¨æ„å°†æ­¤å¤„çš„ã€youre_secondemail@example.comã€ æ¢æˆæ‚¨çš„ä¸ªäººé‚®ç®±ï¼Œè¿™é‡Œçš„æ–‡ä»¶åä»¥`second_rsa`ä¸ºä¾‹ã€‚

```text
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/YOUR_NAME
    Port 22

Host second
    HostName github.com
    User git
    IdentityFile ~/.ssh/second_rsa  // ç”Ÿæˆçš„ç¬¬äºŒä¸ªå…¬é’¥
    Prot 22
```

> å¦‚æœ git ä»“åº“æœºå™¨çš„sshç«¯å£ä¸æ˜¯é»˜è®¤çš„`22`ï¼Œéœ€è¦é…ç½®SSHé…ç½®`~/.ssh/config`çš„**Port**çš„å€¼ä¸ºå½“å‰ç¯å¢ƒçš„å€¼ã€‚

### å…‹éš†ä»£ç éœ€è¦æ³¨æ„çš„åœ°æ–¹

å½“å…‹éš† GitHub ä¸Šçš„æŸä¸ªä»“åº“æ—¶ï¼Œä¹‹å‰çš„ Clone åœ°å€æ˜¯ï¼š

```bash
git clone git@github.com:curder/test.git
```

ç°åœ¨éœ€è¦å°† Clone åœ°å€ä¿®æ”¹ä¸ºï¼š

```bash
git clone second:curder/test.git
```

> å‘½ä»¤è¡Œä¸­çš„`second`æ˜¯åœ¨sshé…ç½®æ–‡ä»¶ä¸­`~/.ssh/config`ä¸­é…ç½®çš„Hostçš„å€¼ã€‚

## å‚è€ƒåœ°å€

- [SSH å…¬é’¥è®¾ç½®](https://coding.net/help/doc/git/ssh-key.html)
- [SSH Config é‚£äº›ä½ æ‰€çŸ¥é“å’Œä¸çŸ¥é“çš„äº‹](https://deepzz.com/post/how-to-setup-ssh-config.html)
- [git/sshæ‹ä¸æ¸…çš„å‡ ä¸ªé—®é¢˜](http://www.cnblogs.com/hustskyking/p/problems-in-git-when-ssh.html)
